<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ZPL Image Converter Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <script defer src="./zpl-image.js"></script>
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
    </style>
  </head>
  <body class="bg-gray-50 text-gray-800 min-h-screen">
    <!-- Header -->
    <header class="bg-indigo-700 shadow-lg">
      <div class="container mx-auto px-4 py-6">
        <h1 class="text-2xl md:text-3xl font-bold text-white flex items-center">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-8 w-8 mr-3"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
            />
          </svg>
          ZPL Image Converter Professional
        </h1>
      </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
      <!-- Card Container -->
      <div class="bg-white rounded-xl shadow-md overflow-hidden mb-8">
        <!-- Drop Zone Section -->
        <div
          class="p-6 bg-gradient-to-r from-indigo-500 to-purple-600 text-white"
        >
          <h2 class="text-xl font-semibold mb-4">Upload Your Image</h2>
          <div
            id="drop"
            class="bg-white/10 backdrop-blur-sm border-2 border-dashed border-white/50 rounded-lg p-8 text-center cursor-pointer transition-all hover:bg-white/20"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-12 w-12 mx-auto mb-4 text-white/80"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
              />
            </svg>
            <p class="text-lg">Drop your image here or click to browse</p>
            <p class="text-sm text-white/70 mt-2">
              Supports PNG, JPG, GIF, BMP
            </p>
          </div>
        </div>

        <!-- Settings Section -->
        <div class="p-6 border-b border-gray-200">
          <h2 class="text-xl font-semibold mb-4 text-gray-700">
            Label Configuration
          </h2>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Size Settings -->
            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
              <h3 class="font-medium text-gray-700 mb-3">Size Settings</h3>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label
                    for="width"
                    class="block text-sm font-medium text-gray-700 mb-1"
                    >Width (cm)</label
                  >
                  <input
                    type="number"
                    id="width"
                    min="1"
                    max="20"
                    step="0.1"
                    value="8"
                    class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 px-3 py-2 border"
                  />
                </div>
                <div>
                  <label
                    for="height"
                    class="block text-sm font-medium text-gray-700 mb-1"
                    >Height (cm)</label
                  >
                  <input
                    type="number"
                    id="height"
                    min="1"
                    max="20"
                    step="0.1"
                    value="4.5"
                    class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 px-3 py-2 border"
                  />
                </div>
              </div>
            </div>

            <!-- Image Settings -->
            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
              <h3 class="font-medium text-gray-700 mb-3">Image Settings</h3>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label
                    for="black"
                    class="block text-sm font-medium text-gray-700 mb-1"
                    >Black Threshold (1-99)</label
                  >
                  <input
                    type="number"
                    id="black"
                    min="1"
                    max="99"
                    step="1"
                    value="50"
                    class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 px-3 py-2 border"
                  />
                </div>
                <div>
                  <label
                    for="darkness"
                    class="block text-sm font-medium text-gray-700 mb-1"
                    >Darkness (%)</label
                  >
                  <input
                    type="number"
                    id="darkness"
                    min="0"
                    max="100"
                    value="70"
                    class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 px-3 py-2 border"
                  />
                </div>
              </div>
            </div>
          </div>

          <!-- Additional Settings -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
            <!-- Rotation -->
            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
              <h3 class="font-medium text-gray-700 mb-3">Image Rotation</h3>
              <div class="space-y-2">
                <label class="flex items-center">
                  <input
                    type="radio"
                    name="rot"
                    value="N"
                    id="rotN"
                    checked
                    class="text-indigo-600 focus:ring-indigo-500 h-4 w-4"
                  />
                  <span class="ml-2 text-sm text-gray-700">Normal</span>
                </label>
                <label class="flex items-center">
                  <input
                    type="radio"
                    name="rot"
                    value="R"
                    id="rotR"
                    class="text-indigo-600 focus:ring-indigo-500 h-4 w-4"
                  />
                  <span class="ml-2 text-sm text-gray-700">Right (CW)</span>
                </label>
                <label class="flex items-center">
                  <input
                    type="radio"
                    name="rot"
                    value="L"
                    id="rotL"
                    class="text-indigo-600 focus:ring-indigo-500 h-4 w-4"
                  />
                  <span class="ml-2 text-sm text-gray-700">Left (CCW)</span>
                </label>
                <label class="flex items-center">
                  <input
                    type="radio"
                    name="rot"
                    value="I"
                    id="rotI"
                    class="text-indigo-600 focus:ring-indigo-500 h-4 w-4"
                  />
                  <span class="ml-2 text-sm text-gray-700">Inverted</span>
                </label>
              </div>
            </div>

            <!-- Format -->
            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
              <h3 class="font-medium text-gray-700 mb-3">ZPL Format</h3>
              <div class="space-y-2">
                <label class="flex items-center">
                  <input
                    type="radio"
                    name="compress"
                    value="Z64"
                    id="z64comp"
                    checked
                    class="text-indigo-600 focus:ring-indigo-500 h-4 w-4"
                  />
                  <span class="ml-2 text-sm text-gray-700">Z64 Format</span>
                </label>
                <label class="flex items-center">
                  <input
                    type="radio"
                    name="compress"
                    value="ACS"
                    id="acscomp"
                    class="text-indigo-600 focus:ring-indigo-500 h-4 w-4"
                  />
                  <span class="ml-2 text-sm text-gray-700">ACS Format</span>
                </label>
              </div>
            </div>

            <!-- Options -->
            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
              <h3 class="font-medium text-gray-700 mb-3">Additional Options</h3>
              <div class="space-y-2">
                <label class="flex items-center">
                  <input
                    type="checkbox"
                    id="notrim"
                    value="Y"
                    class="text-indigo-600 focus:ring-indigo-500 h-4 w-4 rounded"
                  />
                  <span class="ml-2 text-sm text-gray-700">No Trim</span>
                </label>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="mt-6 flex flex-wrap gap-4">
            <button
              id="convertBtn"
              class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5 mr-2"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  fill-rule="evenodd"
                  d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l1.293 1.293a1 1 0 001.414-1.414z"
                  clip-rule="evenodd"
                />
              </svg>
              Convert to ZPL
            </button>
            <button
              id="copyZpl"
              class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5 mr-2"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                <path
                  d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"
                />
              </svg>
              Copy ZPL
            </button>
            <button
              id="downloadBtn"
              class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5 mr-2"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  fill-rule="evenodd"
                  d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"
                  clip-rule="evenodd"
                />
              </svg>
              Download ZPL
            </button>
          </div>

          <div id="loading" class="hidden mt-4 text-gray-700">
            <div class="flex items-center">
              <div
                class="inline-block h-5 w-5 animate-spin rounded-full border-4 border-solid border-indigo-600 border-r-transparent mr-3"
              ></div>
              <span>Converting image to ZPL...</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Preview Section -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Original Image Preview -->
        <div class="bg-white rounded-xl shadow-md overflow-hidden">
          <div class="bg-indigo-700 text-white py-3 px-4">
            <h3 class="font-semibold">Original Image</h3>
          </div>
          <div class="p-4 h-64 flex items-center justify-center bg-gray-100">
            <img
              id="image"
              alt="Original image will appear here"
              class="max-h-full max-w-full object-contain"
            />
          </div>
        </div>

        <!-- Rendered Image Preview -->
        <div class="bg-white rounded-xl shadow-md overflow-hidden">
          <div class="bg-indigo-700 text-white py-3 px-4">
            <h3 class="font-semibold">Rendered Image</h3>
          </div>
          <div class="p-4 h-64 flex items-center justify-center bg-gray-100">
            <canvas
              id="canvas"
              width="10"
              height="10"
              class="max-h-full max-w-full"
            ></canvas>
          </div>
        </div>
      </div>

      <!-- ZPL Output -->
      <div class="mt-8 bg-white rounded-xl shadow-md overflow-hidden">
        <div class="bg-indigo-700 text-white py-3 px-4">
          <h3 class="font-semibold">ZPL Output</h3>
        </div>
        <div class="p-4">
          <textarea
            id="zpltext"
            readonly
            placeholder="ZPL code will appear here after conversion"
            class="w-full h-64 font-mono text-sm p-4 border border-gray-300 rounded-md focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
          ></textarea>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-12">
      <div class="container mx-auto px-4">
        <div class="text-center">
          <p class="text-gray-400">
            &copy; 2025 ZPL Image Converter Professional. All rights reserved.
          </p>
          <p class="text-gray-500 text-sm mt-2">
            Convert your images to ZPL format for thermal label printing
          </p>
        </div>
      </div>
    </footer>

    <script>
      // เขียนโค้ด JavaScript สำหรับการโหลด zpl-image.js และ pako.js
      function loadScript(url, callback) {
        var script = document.createElement("script");
        script.type = "text/javascript";
        script.src = url;
        script.onload = function () {
          if (callback) callback();
        };
        document.head.appendChild(script);
      }

      // โหลด pako.js ก่อน แล้วค่อยโหลด zpl-image.js
      loadScript(
        "https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js",
        function () {
          loadScript("./zpl-image.js", init);
        }
      );

      let _filename = "";
      let imageData = null;

      function init() {
        // Setup event listeners
        document
          .getElementById("rotN")
          .addEventListener("click", convertImage, false);
        document
          .getElementById("rotL")
          .addEventListener("click", convertImage, false);
        document
          .getElementById("rotR")
          .addEventListener("click", convertImage, false);
        document
          .getElementById("rotI")
          .addEventListener("click", convertImage, false);
        document
          .getElementById("black")
          .addEventListener("input", convertImage, false);
        document
          .getElementById("notrim")
          .addEventListener("click", convertImage, false);
        document
          .getElementById("acscomp")
          .addEventListener("click", convertImage, false);
        document
          .getElementById("z64comp")
          .addEventListener("click", convertImage, false);
        document
          .getElementById("width")
          .addEventListener("input", convertImage, false);
        document
          .getElementById("height")
          .addEventListener("input", convertImage, false);
        document
          .getElementById("darkness")
          .addEventListener("input", convertImage, false);
        document
          .getElementById("copyZpl")
          .addEventListener("click", copyZPL, false);
        document
          .getElementById("convertBtn")
          .addEventListener("click", convertImage, false);
        document
          .getElementById("downloadBtn")
          .addEventListener("click", downloadZPL, false);

        // Setup the drop target
        let drop = document.getElementById("drop");

        function candrop(ev) {
          ev.target.classList.add("bg-blue-50", "text-blue-300");
          ev.preventDefault();
          return false;
        }
        function undrop(ev) {
          ev.target.classList.remove("bg-blue-50", "text-blue-300");
        }

        drop.addEventListener("dragover", candrop, false);
        drop.addEventListener("dragenter", candrop, false);
        drop.addEventListener("dragleave", undrop, false);

        drop.addEventListener(
          "drop",
          function (ev) {
            undrop(ev);
            ev.preventDefault(); // stop the browser from redirecting

            let xfer = ev.dataTransfer;
            let files = xfer.files;
            if (!files.length) {
              return;
            }

            let file = files[0];
            let reader = new FileReader();

            reader.onloadend = function () {
              let bin = this.result;
              let img = document.getElementById("image");

              _filename = file.name;
              img.src = bin;
              img.onload = function () {
                imageData = bin;
                convertImage();
              };
            };
            reader.readAsDataURL(file);
            return false;
          },
          false
        );

        // คลิกที่ drop zone เพื่อเลือกไฟล์แบบปกติ
        drop.addEventListener("click", function () {
          let input = document.createElement("input");
          input.type = "file";
          input.accept = "image/*";
          input.onchange = function (e) {
            let file = e.target.files[0];
            if (file) {
              let reader = new FileReader();
              reader.onloadend = function () {
                let bin = this.result;
                let img = document.getElementById("image");
                _filename = file.name;
                img.src = bin;
                img.onload = function () {
                  imageData = bin;
                  convertImage();
                };
              };
              reader.readAsDataURL(file);
            }
          };
          input.click();
        });
      }

      function convertImage() {
        if (!imageData) {
          return;
        }

        document.getElementById("loading").style.display = "block";

        // รับค่าพารามิเตอร์จาก UI
        let black = +document.getElementById("black").value || 50;
        let darkness = +document.getElementById("darkness").value || 70;
        let rotrad = document.querySelector("input[name=rot]:checked");
        let comprad = document.querySelector("input[name=compress]:checked");
        let rot = (rotrad && rotrad.value) || "N";
        let comp = (comprad && comprad.value) || "Z64";
        let notrim = document.getElementById("notrim").checked;

        // รับค่าขนาดที่ต้องการ (เซนติเมตร)
        let widthCm = parseFloat(document.getElementById("width").value);
        let heightCm = parseFloat(document.getElementById("height").value);

        // แปลงจาก cm เป็น dots (203 dpi = ~80dpmm)
        let widthDots = Math.round(widthCm * 80); // 8cm = 640 dots
        let heightDots = Math.round(heightCm * 80); // 4.5cm = 360 dots

        // ประมวลผลรูปภาพ
        processImageWithFixedSize(imageData, widthDots, heightDots, {
          black: black,
          rotate: rot,
          notrim: notrim,
          compress: comp,
          darkness: darkness,
        });
      }

      function processImageWithFixedSize(
        imageData,
        targetWidth,
        targetHeight,
        options
      ) {
        // สร้าง canvas สำหรับปรับขนาด
        let canvas = document.createElement("canvas");
        canvas.width = targetWidth;
        canvas.height = targetHeight;
        let ctx = canvas.getContext("2d");

        // โหลดรูปภาพและปรับขนาด
        let img = new Image();
        img.onload = function () {
          // เคลียร์ canvas
          ctx.fillStyle = "#FFFFFF";
          ctx.fillRect(0, 0, targetWidth, targetHeight);

          // คำนวณอัตราส่วนเพื่อรักษาสัดส่วนภาพ
          let aspectRatio = img.width / img.height;
          let newWidth = targetWidth;
          let newHeight = targetHeight;

          // ปรับขนาดให้ได้ตามที่กำหนด
          ctx.drawImage(img, 0, 0, targetWidth, targetHeight);

          // แปลง canvas เป็น dataURL
          let resizedImageData = canvas.toDataURL("image/png");

          // แสดงภาพที่ปรับขนาดแล้ว
          let imgElement = document.getElementById("image");
          imgElement.src = resizedImageData;

          // แปลงเป็น ZPL
          let imgObj = document.createElement("img");
          imgObj.onload = function () {
            let res;
            if (options.compress === "Z64") {
              res = imageToZ64(imgObj, {
                black: options.black,
                rotate: options.rotate,
                notrim: options.notrim,
              });
              renderResult(res, "Z64");
            } else {
              res = imageToACS(imgObj, {
                black: options.black,
                rotate: options.rotate,
                notrim: options.notrim,
              });
              renderResult(res, "ACS");
            }
          };
          imgObj.src = resizedImageData;
        };
        img.src = imageData;
      }

      function renderResult(res, format) {
        // รับค่า darkness จาก UI
        let darkness = document.getElementById("darkness").value;

        // วาดภาพที่แปลงแล้วลงบน canvas
        let bmp;
        if (format === "Z64") {
          bmp = z64ToCanvas(res.z64, res.rowlen);
        } else {
          bmp = acsToCanvas(res.acs, res.rowlen);
        }

        let cvs = document.getElementById("canvas");
        cvs.width = bmp.width;
        cvs.height = bmp.height;
        cvs.getContext("2d").drawImage(bmp, 0, 0);

        // สร้าง ZPL ด้วยพารามิเตอร์ที่กำหนด
        let zpl =
          "^XA\n" +
          "^FO0,0" +
          "^FX " +
          _filename +
          " (" +
          res.width +
          "x" +
          res.height +
          "px, " +
          res.rotate +
          "-Rotate, " +
          document.getElementById("black").value +
          "% Black)^FS\n" +
          "^GFA," +
          res.length +
          "," +
          res.length +
          "," +
          res.rowlen +
          "," +
          (format === "Z64" ? res.z64 : res.acs) +
          "\n" +
          "^MD" +
          darkness +
          "\n" +
          "^XZ";

        // แสดง ZPL ใน textarea
        document.getElementById("zpltext").value = zpl;

        // ซ่อน loading
        document.getElementById("loading").style.display = "none";
      }

      function z64ToCanvas(z64, rowl) {
        // Strip the ':Z64:' prefix and :XXXX crc16 suffix and convert to binary string.
        // We do not validate the CRC.
        let bin = atob(z64.substr(5, z64.length - 10));

        // pako wants a Uint8Array
        let buf = new Uint8Array(bin.length);
        for (let i = 0, l = bin.length; i < l; i++) {
          buf[i] = bin.charCodeAt(i);
        }

        let grf = pako.inflate(buf);
        let l = grf.length;
        let w = rowl * 8; // rowl is in bytes
        let h = ~~(l / rowl);

        // Render the GRF to a canvas
        let cvs = document.createElement("canvas");
        cvs.width = w;
        cvs.height = h;

        let ctx = cvs.getContext("2d");
        let bmap = ctx.getImageData(0, 0, w, h);
        let data = bmap.data;
        let offs = 0;
        for (let i = 0; i < l; i++) {
          let byte = grf[i];
          for (let bit = 0x80; bit; bit = bit >>> 1, offs += 4) {
            if (bit & byte) {
              data[offs] = 0;
              data[offs + 1] = 0;
              data[offs + 2] = 0;
              data[offs + 3] = 255; // Fully opaque
            }
          }
        }
        ctx.putImageData(bmap, 0, 0);
        return cvs;
      }

      function acsToCanvas(acs, rowl) {
        let hex = acs.replace(/[g-zG-Y]+([0-9a-fA-F])/g, ($0, $1) => {
          let rep = 0;
          for (let i = 0, l = $0.length - 1; i < l; i++) {
            let cd = $0.charCodeAt(i);
            if (cd < 90) {
              // 'Z'
              rep += cd - 70;
            } else {
              rep += (cd - 102) * 20;
            }
          }
          return $1.repeat(rep);
        });

        let bytes = Array(hex.length / 2);
        for (let i = 0, l = hex.length; i < l; i += 2) {
          bytes[i >> 1] = parseInt(hex.substr(i, 2), 16);
        }

        let l = bytes.length;
        let w = rowl * 8; // rowl is in bytes
        let h = ~~(l / rowl);

        // Render the GRF to a canvas
        let cvs = document.createElement("canvas");
        cvs.width = w;
        cvs.height = h;

        let ctx = cvs.getContext("2d");
        let bmap = ctx.getImageData(0, 0, w, h);
        let data = bmap.data;
        let offs = 0;
        for (let i = 0; i < l; i++) {
          let byte = bytes[i];
          for (let bit = 0x80; bit; bit = bit >>> 1, offs += 4) {
            if (bit & byte) {
              data[offs] = 0;
              data[offs + 1] = 0;
              data[offs + 2] = 0;
              data[offs + 3] = 255; // Fully opaque
            }
          }
        }
        ctx.putImageData(bmap, 0, 0);
        return cvs;
      }

      function copyZPL() {
        let ta = document.getElementById("zpltext");
        ta.select();
        document.execCommand("copy");
        alert("ZPL code copied to clipboard!");
      }

      function downloadZPL() {
        let zplContent = document.getElementById("zpltext").value;
        if (!zplContent) {
          alert("No ZPL code to download");
          return;
        }

        const blob = new Blob([zplContent], { type: "text/plain" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download =
          (_filename ? _filename.replace(/\.[^/.]+$/, "") : "label") + ".zpl";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }
    </script>
  </body>
</html>
